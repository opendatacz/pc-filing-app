<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>PC Filing App</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="">
	<meta name="author" content="">

	<!-- Le styles -->
	<link href="./bootstrap/css/bootstrap.css" rel="stylesheet">	
	<link href="./bootstrap/css/won.css" rel="stylesheet">
	<link href="css/style.css" rel="stylesheet">
	<style type="text/css">
	body {
		padding-top: 60px;
		padding-bottom: 40px;
	}
	
	.sidebar-nav {
		padding: 9px 0;
	}
	</style>
	<link href="./bootstrap/css/bootstrap-responsive.css" rel="stylesheet">

	<!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
	<!--[if lt IE 9]>
      	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
   	<![endif]-->
</head>

<body>

	<div class="navbar navbar-inverse navbar-fixed-top">
		<div class="navbar-inner">
			<div class="container-fluid">
				<a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse"> <span
					class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span>
				</a> <a class="brand" href="#">PC Filing App</a>
				<div class="nav-collapse collapse">
					<p class="navbar-text pull-right">
						Logged in as <a id="username" href="#" class="navbar-link"></a> <a href="SystemManager?action=logout&forward=.%2F%3Ft%3Dinfo%26m%3D%3Cstrong%3EYou%20have%20been%20successfully%20logged%20out.%3C%2Fstrong%3E" class="navbar-link" style="margin-left: 1em "><i class="icon-off icon-white"></i></a> 						
					</p>
					<ul class="nav">
						<li><a href="#" id="enableGuide" onclick="userHelper('on')">Help</a></li>
					</ul>
				</div>
			</div>
		</div>
	</div>

	<div class="container-fluid">
		<div class="row-fluid">
			<div class="span2">
				<div class="well sidebar-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Account</li>
						<li class=""><a href="supplier-account.html">My account</a></li>						
						<li class="divider"></li>
						<li class="nav-header">Invitations</li>						
						<li class="active"><a href="supplier-invitations.html">My invitations</a></li>
						<li class="divider"></li>
						<li class="nav-header">My tenders</li>
						<li class=""><a href="supplier-prepared.html">Prepared tenders</a></li>
						<li class=""><a href="supplier-submitted.html">Submitted tenders</a></li>
						<li class=""><a href="supplier-withdrawn.html">Withdrawn tenders</a></li>
						<li class="divider"></li>
						<li class=""><a href="supplier-for-cancelled.html">Tenders for cancelled calls</a></li>
						<li class=""><a href="supplier-rejected.html">Rejected tenders</a></li><li><a href="supplier-nonawarded.html">Non-awarded tenders</a></li>						
						<li class=""><a href="supplier-awarded.html">Awarded tenders</a></li>
						<li class=""><a href="supplier-for-withdrawn.html">Tenders for withdrawn calls</a></li>
						<li class=""><a href="supplier-completed.html">Completed tenders</a></li>
						<li class="divider"></li>
						<li class="nav-header">Calls for tenders</li>
						<li class=""><a href="supplier-calls.html">Open calls</a></li>
						<li class="divider"></li>
						<li class="nav-header">Analytics</li>
						<li class="disabled"> <a href="#">Pricing</a></li>
              			<li class="disabled"> <a href="#">Saving</a></li>              			
              			<li class="disabled"><a href="#" class="btn" style="margin: 10px;">Create analysis</a></li>             			
					</ul>
				</div>
			</div>

			<div class="span10">	
        
        <div class="alert hide" id="userHelper">
			<button class="close" onclick="userHelper('off')" title="Disable guide" >Ã—</button>
			On this screen, you can see your invitations from buyers to submit a tender to their calls for tenders.<br/>
			You can accept the invitation and prepare your tender, or you can reject the invitation.
		</div>
          
          <div class="pull-right" style="padding-top: 5px;">
            <a href="#" rel="tooltip" data-placement="bottom" class="btn disabled" title="Filter items"><i class="icon-filter"></i></a>
            <a href="#" rel="tooltip" data-placement="bottom" class="btn disabled" title="Customize columns"><i class="icon-wrench"></i></a>
            <a href="#" rel="tooltip" data-placement="bottom" class="btn disabled" title="Switch layout"><i class="icon-eye-open"></i></a>
          </div>
                    
          <h3 style="margin-bottom: 20px;">Invitations</h3>
          
          <table class="table table-striped table-bordered" style="display:none;" id="contractTable">
            <thead>
              <tr>
                <th>Title</th>
                <th>Buyer</th>
                <th>Estimated price</th>
                <th>Specification (CPVs)</th>
                <th>Publication date</th>
                <th>Tender deadline</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
            </tbody>
          </table>

		  <div style="text-align: center;" id="progressbar"><br><img src="images/progressbar.gif"/></div>
          
          <div class="pagination pagination-centered">
            <ul id="pages">
			
            </ul>
          </div>
		  
		  <div id="showAllPages" class="hide pagination pull-right" style="margin:0; margin-top:-16px;">
		  <ul>
				<li><a onclick="$('.3dots').remove(); $('#pages li').removeClass('reallyhide'); $('#showAllPages').remove(); " href="#">show all pages</a>
				</li>
		  </ul>
		  </div>
		  
        </div>        
      </div>
    </div>

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="bootstrap/js/jquery.js"></script>
	<script src="js/sessionstorage.1.4.js"></script>
	<script src="js/functions.js"></script>
	<script src="js/toolsSupplier.js"></script>
	<script src="js/script.js"></script>
    <script src="bootstrap/js/bootstrap-transition.js"></script>
    <script src="bootstrap/js/bootstrap-alert.js"></script>
    <script src="bootstrap/js/bootstrap-modal.js"></script>
    <script src="bootstrap/js/bootstrap-dropdown.js"></script>
    <script src="bootstrap/js/bootstrap-scrollspy.js"></script>
    <script src="bootstrap/js/bootstrap-tab.js"></script>
    <script src="bootstrap/js/bootstrap-tooltip.js"></script>
    <script src="bootstrap/js/bootstrap-popover.js"></script>
    <script src="bootstrap/js/bootstrap-button.js"></script>
    <script src="bootstrap/js/bootstrap-collapse.js"></script>
    <script src="bootstrap/js/bootstrap-carousel.js"></script>
    <script src="bootstrap/js/bootstrap-typeahead.js"></script>

	<script type="text/javascript">
	var pagesTotal = 1;
	var currentPage = 1;
	var windowSize = 3;	// in each direction from the current page

	function initPages()
	{
		$.getJSON("InvitationComponent?action=getInvitationsPages", function(data)
		{
			pagesTotal = data;
			
			if (pagesTotal <= 1)
				return;
				
			if (pagesTotal > windowSize + 2) {
				$('#showAllPages').removeClass("hide"); 
			}

			$("#pages").append('<li><a href="#" id="loadPreviousContracts">Prev</a></li>');
			$("#loadPreviousContracts").click(function() {
				if ($(this).parent().hasClass("disabled")) {
					return false;
				};
				currentPage--;
				togglePageButtons();
				loadContracts();
			});

			for (var i = 1; i <= pagesTotal; i++) {
				$("#pages").append('<li><a href="#" id="loadContractsPage' + i +'">' + i +'</a></li>');
				$("#loadContractsPage" + i).on('click', function() {
					if ($(this).parent().hasClass("active")) {
						return false;
					};
					currentPage = parseInt($(this).attr("id").match(/(\d+)$/)[0], 10);
					togglePageButtons();
					loadContracts();
				});			
			}

			$("#pages").append('<li><a href="#" id="loadNextContracts">Next</a></li>');
			$("#loadNextContracts").click(function() {
				if ($(this).parent().hasClass("disabled")) {
					return false;
				};
				currentPage++;
				togglePageButtons();
				loadContracts();
			});			

			togglePageButtons();
		}
		);
	}
	
	function loadContracts()
	{
		$.getJSON("InvitationComponent?action=getInvitations&from=" + 10 * (currentPage - 1) + "&to=" + 10 * currentPage, function(data)
		{
			$('#progressbar').hide();
			$('#contractTable').fadeIn('slow');	
			$('#contractTable tbody').remove();	
			$.each(data, function(i,data){
				var div_data = '<tr style="vertical-align: middle;"><td><a href="supplier-view-event.html" onclick="showEvent(\'' + encodeURIComponent(data.contractURL) + '\',\'' + encodeURIComponent(data.buyerURL) + '\')">' + data.title + '</a></td>         <td><a href="entity-buyer.html" onclick="showEntity(\''+data.ownerEntity+'\')">' + data.ownerName + '</a></td>         <td>' + data.price + ' ' + data.currency + '</td>                  <td>' + data.cpv + '<br>                  </td>                  <td>' + htmlEncode(data.published) +'</td>                  <td>'+ data.deadline +'</td> <td><div class="btn-group"> <a class="btn " href="supplier-create-tender.html" onclick="saveTenderInfo(\'' + encodeURIComponent(data.contractURL) + '\', \'' + encodeURIComponent(data.title) + '\', \'' + encodeURIComponent(data.buyerURL) + '\')"  title="Accept">Accept</a> <a class="btn " href="#" onclick="deleteInv(\'' + encodeURIComponent(data.invitationURL) + '\')"  title="Delete">Delete</a></div></td>  </tr>';
				$(div_data).appendTo("#contractTable");
			});
			$('td').tooltip();
		});
	}
	
	function deleteInv(contractURL) {
		if (!confirm('Really delete this invitation?')) {
			return;
		}
		
		$.getJSON("InvitationComponent?action=deleteInvitation&invURL=" + contractURL, function(data)
		{
			window.location.reload();
		});
	}
	
	function togglePageButtons() {
		$("#pages li").addClass("reallyhide");
		$("#loadPreviousContracts").parent().removeClass("reallyhide");
		$("#loadNextContracts").parent().removeClass("reallyhide");
		$("#loadContractsPage" + 1).parent().removeClass("reallyhide");
		$("#loadContractsPage" + pagesTotal).parent().removeClass("reallyhide");
		
		$("#pages li").removeClass("active");
		if (currentPage == 1) {
			$("#loadPreviousContracts").parent().addClass("disabled");
		} else {
			$("#loadPreviousContracts").parent().removeClass("disabled");
		};
		if (currentPage == pagesTotal) {
			$("#loadNextContracts").parent().addClass("disabled");
		} else {
			$("#loadNextContracts").parent().removeClass("disabled");
		};
		$("#loadContractsPage" + currentPage).parent().addClass("active");
		
		for (var i = currentPage - windowSize; i <= currentPage + windowSize; i++) {
			if (i > 1 && i < pagesTotal) {
				$("#loadContractsPage" + i).parent().removeClass("reallyhide");
			}
		}
		
		$(".3dots").remove();
		if ((currentPage - windowSize - 1 >= 1) && $("#loadContractsPage" + (currentPage - windowSize - 1)).parent().hasClass('reallyhide')) {
			$("#loadContractsPage" + (currentPage - windowSize - 1)).parent().after('<li class="3dots disabled"><a href="#">...</a></li>');
		}
		if ((currentPage + windowSize + 1 <= pagesTotal) && $("#loadContractsPage" + (currentPage + windowSize + 1)).parent().hasClass('reallyhide')) {
			$("#loadContractsPage" + (currentPage + windowSize + 1)).parent().before('<li class="3dots disabled"><a href="#">...</a></li>');
		}
	}
	
	$(window).ready(function() {
		initPages();
		loadContracts();
	});	
	
	function saveTenderInfo(contractURL, title, buyerURL) {
		sessionStorage.contractURL = contractURL;
		sessionStorage.contractTitle = title;
		sessionStorage.buyerURL = buyerURL;
	}

	</script>
	
    <script>
      $("a").tooltip();
    </script>
  </body>
</html>