<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>PC Filing App</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="bootstrap/css/bootstrap.css" rel="stylesheet">
	<link href="css/style.css" rel="stylesheet">
    <style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 40px;
      }
      footer {
        padding-top: 60px;
      }
    </style>
    <link href="bootstrap/css/bootstrap-responsive.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="bootstrap/ico/favicon.ico">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="bootstrap/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="bootstrap/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="bootstrap/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="bootstrap/ico/apple-touch-icon-57-precomposed.png">
  </head>

  <body>

    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="./">TenderStats <sup><i>BETA</i></sup></a>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="container">

      <!-- Main hero unit for a primary marketing message or call to action -->
      <div class="hero-unit">
        <h1>Welcome in TenderStats <sup><i>BETA</i></sup> !</h1>
        <p>TenderStats is an application for public procurement.</p>
        <p><a class="btn btn-primary btn-large">Learn more &raquo;</a></p>
      </div>

	  <!-- Message from query string -->
	  <div id="message" class="alert fade in hide">
         <button type="button" class="close" data-dismiss="alert">&times;</button>
      </div>
	  
      <div class="row">
        <div class="span12">
          <h2>New invitation</h2>
          <p>You have received invitation <span id="invitation">#</span></p>
        </div>
      </div>
      
      <div class="row">
      	<div class="span12">
          <p class="logged-in hide">You are currently logged in as <span id="username"></span></p>   
		  <p><input type="submit" form="obtain-invitation" class="btn btn-primary logged-in hide" name="submit" value="Obtain your invitation">
		  <a id="not-logged-in" href="#login-supplier" role="button" class="btn btn-primary" data-toggle="modal">Login as Supplier</a> 
          <a class="btn add-inv-href" href="register-supplier.html?inv_id={inv_id}&email={con}">Register as Supplier</a></p>                 
        </div>
      </div>
      
      <div class="row">
      	<div class="span12">
          <p>
		  </p>
        </div>
      </div>

      <hr>
	  	
	<form class="hide" id="obtain-invitation" action="InvitationComponent" method="post">
		<input name="action" type="hidden" value="obtain">
		<input name="inv_id" class="add-inv-val" type="hidden" value="{inv_id}">
		<input name="email" class="add-inv-val" type="hidden" value="{con}">		
		<input name="forward" id="forward" type="hidden" value="supplier-invitations.html">
		<input name="forward-if-fail" type="hidden" value="./?t=error&m=<strong>Oops. Something went wrong.</strong>">		
	</form>
	  
	<!-- Modal -->
	<div id="login-supplier" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="supplier-label" aria-hidden="true">
		<div class="modal-header">
		<button type="button" class="close" data-dismiss="modal" aria-hidden="true"><i class="icon-remove"></i></button>
		<h3 id="supplier-label">Login as Supplier</h3>
		</div>
		<div class="modal-body">
		
		<form class="form-horizontal" id="login-supplier-form" action="SystemManager" method="post">
			<input name="action" type="hidden" value="login">
			<input name="forward" id="forward" class="add-inv-val" type="hidden" value="InvitationComponent?action=obtain&forward=supplier-invitations.html&inv_id={inv_id}&email={con}">
			<input name="forward-if-fail" type="hidden" value="./?t=error&m=<strong>Your e-mail and password did not match.</strong><br> Please try again.">
			<div class="control-group">
			  <label class="control-label">E-mail</label>
			  <div class="controls">
				<input name="username" class="input-xlarge" type="text" placeholder="Your e-mail" autofocus required>
			  </div>
			</div>
			<div class="control-group">
			  <label class="control-label">Password</label>
			  <div class="controls">
				<input name="password" class="input-xlarge" type="password" placeholder="Your password" required>
			  </div>
			</div>
		  </form>
		
		</div>
		
		<div class="modal-footer">
			<button class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
			<input form="login-supplier-form" class="btn btn-primary" type="submit" name="submit" value="Login as a Supplier" default>
			<!-- HTML < 5 : <button onclick="$('#login-supplier-form').submit();" class="btn btn-primary">Login</button>-->
		</div>
    </div>	  

      <!--<footer>
        <div class="container">
          <p class="pull-right"><a href="#">Back to top</a></p>
          <p>Designed and built with <a href="http://twitter.github.com/bootstrap/index.html" target="_blank">Twitter Bootstrap</a> by <a href="http://www.opendata.cz" target="_blank">OpenData.cz</a> and <a href="http://www.tenderstats.com" target="_blank">TenderStats</a>.</p>
          <p>Code licensed under the <a href="http://www.apache.org/licenses/LICENSE-2.0" target="_blank">Apache License v2.0</a>. Documentation licensed under <a href="http://creativecommons.org/licenses/by/3.0/">CC BY 3.0</a>.</p>
          <ul class="footer-links">
            <li><a href="http://blog.tenderstats.com">Read the blog</a></li>
            <li><a href="about.html">About TenderStats</a></li>
          </ul>
        </div>
      </footer>-->

    </div> <!-- /container -->

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="bootstrap/js/jquery.js"></script>
    <script src="bootstrap/js/bootstrap-transition.js"></script>
    <script src="bootstrap/js/bootstrap-alert.js"></script>
    <script src="bootstrap/js/bootstrap-modal.js"></script>
    <script src="bootstrap/js/bootstrap-dropdown.js"></script>
    <script src="bootstrap/js/bootstrap-scrollspy.js"></script>
    <script src="bootstrap/js/bootstrap-tab.js"></script>
    <script src="bootstrap/js/bootstrap-tooltip.js"></script>
    <script src="bootstrap/js/bootstrap-popover.js"></script>
    <script src="bootstrap/js/bootstrap-button.js"></script>
    <script src="bootstrap/js/bootstrap-collapse.js"></script>
    <script src="bootstrap/js/bootstrap-carousel.js"></script>
    <script src="bootstrap/js/bootstrap-typeahead.js"></script>

	<script>
	
	function $_GET(variable) {
	  var query = window.location.search.substring(1);
	  var vars = query.split("&");
	  for (var i=0;i<vars.length;i++) {
		var pair = vars[i].split("=");
		if (pair[0] == variable) {
		  return decodeURIComponent(pair[1]);
		}
	  }
	}
	
	// ?m=lorem ipsum&t=info
	$(window).ready(function() {
		var mtype = $_GET("t");
		if (mtype != null) {
			$('#message').addClass('alert-' + mtype);
		}
		var mtext = $_GET("m");
		if (mtext != null) {
			$('#message').append(mtext).fadeIn('slow');
		}
		
		invitation = $_GET("inv_id");
		email = $_GET("email");
		if (invitation != null) {
			$('#invitation').append(invitation);
		}
		
		checkUser();
		addHrefVal();
		
	});
	
// 	$(window).ready(function() {		
// 		initPages();
// 		loadContracts();
// 	});
	var invitation;
	var email;	
	function addHrefVal() {
		$(".add-inv-href").each(function(){
			var href = $(this).attr('href');
			$(this).attr('href',href.replace('{inv_id}',invitation));
			var href = $(this).attr('href');
			$(this).attr('href',href.replace('{con}',email));
		});
		
		$(".add-inv-val").each(function(){
			var val = $(this).attr('value');
			$(this).attr('value',val.replace('{inv_id}',invitation));
			var val = $(this).attr('value');
			$(this).attr('value',val.replace('{con}',email));
		});		
		
	}	
	
	function checkUser() {		
		$.getJSON("SystemManager?action=getuser", function(data)
		{
			if (data == null || data.length == 0) {
				sessionStorage.clear();				
			} else {				
				sessionStorage.username = data;
			}
			
			if (sessionStorage.username != undefined) {
				$(".logged-in").show();
				$("#username").append(sessionStorage.username);
				$("#not-logged-in").removeClass("btn-primary");
			}
		});		
		
	}
	
	</script>
	
  </body>
</html>